<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Game ƒêo√°n S·ªë - 3 C·∫•p ƒê·ªô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ===== RESET & VARIABLES ===== */
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --secondary: #7209b7;
      --success: #06d6a0;
      --warning: #ffd166;
      --danger: #ef476f;
      --dark: #2b2d42;
      --light: #f8f9fa;
      --white: #ffffff;
      
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: var(--dark);
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: var(--white);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      animation: fadeIn 0.8s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* ===== HEADER ===== */
    .header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 25px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 2.2rem;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .header p {
      opacity: 0.9;
      font-size: 1rem;
    }
    
    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .stat-box {
      background: rgba(255,255,255,0.15);
      padding: 15px 20px;
      border-radius: 12px;
      min-width: 120px;
    }
    
    .stat-label {
      display: block;
      font-size: 0.8rem;
      opacity: 0.9;
      margin-bottom: 5px;
    }
    
    .stat-value {
      display: block;
      font-size: 1.5rem;
      font-weight: 700;
    }
    
    /* ===== MODE SELECTION ===== */
    .mode-section {
      padding: 20px;
      background: var(--light);
    }
    
    .mode-section h2 {
      text-align: center;
      margin-bottom: 20px;
      color: var(--dark);
      font-size: 1.5rem;
    }
    
    .mode-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .mode-btn {
      flex: 1;
      min-width: 200px;
      padding: 20px;
      border: none;
      border-radius: var(--radius);
      background: white;
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow);
    }
    
    .mode-btn i {
      font-size: 2rem;
    }
    
    .mode-btn.active {
      color: white;
      transform: translateY(-5px);
    }
    
    .mode-btn.easy.active { background: linear-gradient(135deg, #06d6a0, #04b487); }
    .mode-btn.normal.active { background: linear-gradient(135deg, #ffd166, #ffb142); }
    .mode-btn.hard.active { background: linear-gradient(135deg, #ef476f, #d8345f); }
    
    /* ===== GAME AREA ===== */
    .game-area {
      padding: 20px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
    }
    
    @media (max-width: 900px) {
      .game-area { grid-template-columns: 1fr; }
    }
    
    /* ===== GAME INFO ===== */
    .game-info {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    
    .game-info h3 {
      margin-bottom: 15px;
      color: var(--dark);
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .info-item {
      background: white;
      padding: 12px;
      border-radius: 12px;
      text-align: center;
    }
    
    .info-label {
      display: block;
      font-size: 0.8rem;
      color: var(--dark);
      margin-bottom: 5px;
    }
    
    .info-value {
      display: block;
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--dark);
    }
    
    /* ===== GUESS INPUTS ===== */
    .guess-section {
      text-align: center;
    }
    
    .guess-inputs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .number-input {
      width: 55px;
      height: 55px;
      border-radius: 12px;
      border: 2px solid #e0e0e0;
      text-align: center;
      font-size: 1.8rem;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
      background: white;
      color: var(--dark);
      transition: var(--transition);
    }
    
    .number-input:focus {
      border-color: var(--primary);
      outline: none;
      transform: scale(1.05);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }
    
    .legend {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
    }
    
    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .legend-dot.correct { background: var(--success); }
    .legend-dot.partial { background: var(--warning); }
    .legend-dot.wrong { background: var(--danger); }
    
    /* ===== BUTTONS ===== */
    .buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--radius);
      font-family: 'Poppins', sans-serif;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 150px;
      justify-content: center;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }
    
    .btn-secondary {
      background: var(--warning);
      color: #333;
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--dark);
      color: var(--dark);
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.2);
    }
    
    .btn:active {
      transform: translateY(-1px);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }
    
    /* ===== ERROR MESSAGE ===== */
    .error-message {
      text-align: center;
      color: var(--danger);
      font-weight: 500;
      padding: 10px;
      background: rgba(239, 71, 111, 0.1);
      border-radius: 8px;
      margin: 10px 0;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* ===== HISTORY ===== */
    .history-section {
      grid-column: 1 / -1;
      margin-top: 20px;
    }
    
    .history-section h3 {
      margin-bottom: 15px;
      font-size: 1.3rem;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .history-list {
      background: var(--light);
      border-radius: var(--radius);
      padding: 15px;
      max-height: 250px;
      overflow-y: auto;
    }
    
    .history-item {
      background: white;
      padding: 12px 15px;
      border-radius: 10px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .guess-numbers {
      display: flex;
      gap: 8px;
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .guess-feedback {
      display: flex;
      gap: 8px;
    }
    
    .feedback-icon {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.7rem;
    }
    
    .feedback-icon.correct { background: var(--success); }
    .feedback-icon.partial { background: var(--warning); color: #333; }
    .feedback-icon.wrong { background: var(--danger); }
    
    /* ===== GAME RESULT ===== */
    .game-result {
      text-align: center;
      padding: 20px;
      border-radius: var(--radius);
      margin: 15px 0;
      font-size: 1.1rem;
      font-weight: 600;
      animation: pulse 2s infinite;
      display: none;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    .game-result.win {
      background: linear-gradient(135deg, rgba(6, 214, 160, 0.1), rgba(4, 180, 135, 0.2));
      color: var(--success);
      border: 2px solid var(--success);
    }
    
    .game-result.lose {
      background: linear-gradient(135deg, rgba(239, 71, 111, 0.1), rgba(216, 52, 95, 0.2));
      color: var(--danger);
      border: 2px solid var(--danger);
    }
    
    /* ===== INSTRUCTIONS ===== */
    .instructions {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, #fdfcfb, #f5f0eb);
      border-radius: var(--radius);
      border: 2px dashed var(--warning);
    }
    
    .instructions h3 {
      margin-bottom: 15px;
      font-size: 1.3rem;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .instruction-steps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 15px;
    }
    
    .step {
      background: white;
      padding: 15px;
      border-radius: 10px;
      position: relative;
      box-shadow: var(--shadow);
    }
    
    .step-number {
      position: absolute;
      top: -10px;
      left: -10px;
      width: 30px;
      height: 30px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.9rem;
    }
    
    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .header h1 { font-size: 1.8rem; }
      .stat-box { min-width: 100px; padding: 12px 15px; }
      .stat-value { font-size: 1.3rem; }
      .mode-btn { min-width: 100%; }
      .number-input { width: 45px; height: 45px; font-size: 1.5rem; }
      .btn { min-width: 100%; }
      .game-area { padding: 15px; }
    }
    
    @media (max-width: 480px) {
      body { padding: 10px; }
      .container { border-radius: 20px; }
      .header { padding: 20px; }
      .stats { gap: 10px; }
      .mode-buttons { gap: 10px; }
      .guess-inputs { gap: 8px; }
      .buttons { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1><i class="fas fa-gamepad"></i> GAME ƒêO√ÅN S·ªê</h1>
      <p>Th·ª≠ th√°ch tr√≠ tu·ªá v·ªõi 3 c·∫•p ƒë·ªô kh√≥</p>
      
      <div class="stats">
        <div class="stat-box">
          <span class="stat-label">ƒêI·ªÇM CAO</span>
          <span id="highScore" class="stat-value">0</span>
        </div>
        <div class="stat-box">
          <span class="stat-label">ƒêI·ªÇM</span>
          <span id="score" class="stat-value">0</span>
        </div>
        <div class="stat-box">
          <span class="stat-label">C·∫§P ƒê·ªò</span>
          <span id="level" class="stat-value">D·ªÖ</span>
        </div>
      </div>
    </header>

    <!-- Mode Selection -->
    <section class="mode-section">
      <h2><i class="fas fa-sliders-h"></i> CH·ªåN C·∫§P ƒê·ªò</h2>
      <div class="mode-buttons">
        <button class="mode-btn easy active" data-mode="easy">
          <i class="fas fa-seedling"></i>
          <span>D·ªÑ</span>
          <small>5 s·ªë ‚Ä¢ 10 l∆∞·ª£t</small>
        </button>
        
        <button class="mode-btn normal" data-mode="normal">
          <i class="fas fa-user"></i>
          <span>TRUNG B√åNH</span>
          <small>6 s·ªë ‚Ä¢ 12 l∆∞·ª£t</small>
        </button>
        
        <button class="mode-btn hard" data-mode="hard">
          <i class="fas fa-fire"></i>
          <span>KH√ì</span>
          <small>7 s·ªë ‚Ä¢ 15 l∆∞·ª£t</small>
        </button>
      </div>
    </section>

    <!-- Main Game Area -->
    <main class="game-area">
      <!-- Game Info -->
      <div class="game-info">
        <h3><i class="fas fa-chart-line"></i> TH√îNG TIN</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">S·ªê L∆Ø·ª¢NG</span>
            <span id="currentLength" class="info-value">5</span>
          </div>
          <div class="info-item">
            <span class="info-label">L∆Ø·ª¢T ƒêO√ÅN</span>
            <span id="attemptInfo" class="info-value">0/10</span>
          </div>
          <div class="info-item">
            <span class="info-label">TH·ªúI GIAN</span>
            <span id="timer" class="info-value">00:00</span>
          </div>
          <div class="info-item">
            <span class="info-label">ƒêI·ªÇM</span>
            <span id="currentScore" class="info-value">0</span>
          </div>
        </div>
      </div>

      <!-- Guess Section -->
      <div class="guess-section">
        <div class="legend">
          <div class="legend-item">
            <span class="legend-dot correct"></span>
            <span>ƒê√∫ng s·ªë & v·ªã tr√≠</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot partial"></span>
            <span>ƒê√∫ng s·ªë, sai v·ªã tr√≠</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot wrong"></span>
            <span>Sai ho√†n to√†n</span>
          </div>
        </div>

        <form id="guessForm" autocomplete="off">
          <div class="guess-inputs" id="inputs"></div>
          
          <div id="error" class="error-message"></div>
          
          <div class="buttons">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-paper-plane"></i>
              ƒêO√ÅN S·ªê
            </button>
            <button type="button" id="hintBtn" class="btn btn-secondary">
              <i class="fas fa-lightbulb"></i>
              G·ª£i √Ω <span id="hintCount">(3)</span>
            </button>
            <button type="button" id="restartBtn" class="btn btn-outline">
              <i class="fas fa-redo"></i>
              Ch∆°i l·∫°i
            </button>
          </div>
        </form>
      </div>

      <!-- Game Result -->
      <div id="endMessage" class="game-result"></div>
      
      <div id="playAgain" class="buttons" style="display: none;">
        <button id="playAgainBtn" class="btn btn-primary">
          <i class="fas fa-play-circle"></i>
          Ch∆°i l·∫°i
        </button>
      </div>

      <!-- History -->
      <section class="history-section">
        <h3><i class="fas fa-history"></i> L·ªäCH S·ª¨ ƒêO√ÅN</h3>
        <div id="history" class="history-list"></div>
      </section>

      <!-- Instructions -->
      <section class="instructions">
        <h3><i class="fas fa-graduation-cap"></i> H∆Ø·ªöNG D·∫™N CH∆†I</h3>
        <div class="instruction-steps">
          <div class="step">
            <div class="step-number">1</div>
            <p>ƒêo√°n <strong>s·ªë b√≠ m·∫≠t</strong> g·ªìm c√°c ch·ªØ s·ªë kh√°c nhau</p>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <p>Ch·ªØ s·ªë ƒë·∫ßu ti√™n <strong>kh√¥ng ƒë∆∞·ª£c l√† 0</strong></p>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <p>S·ª≠ d·ª•ng ph·∫£n h·ªìi ƒë·ªÉ <strong>suy lu·∫≠n</strong> s·ªë ƒë√∫ng</p>
          </div>
          <div class="step">
            <div class="step-number">4</div>
            <p>Chi·∫øn th·∫Øng b·∫±ng c√°ch ƒëo√°n ƒë√∫ng tr∆∞·ªõc khi <strong>h·∫øt l∆∞·ª£t</strong></p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ===== GAME LOGIC =====
    class GameDoanSo {
      constructor() {
        this.config = {
          easy: { length: 5, maxAttempts: 10, multiplier: 1 },
          normal: { length: 6, maxAttempts: 12, multiplier: 2 },
          hard: { length: 7, maxAttempts: 15, multiplier: 3 }
        };
        
        this.currentMode = 'easy';
        this.secretNumber = [];
        this.attempts = 0;
        this.history = [];
        this.score = 0;
        this.highScore = this.loadHighScore();
        this.hintsLeft = 3;
        this.startTime = null;
        this.timerInterval = null;
        this.gameActive = false;
        
        this.init();
      }
      
      init() {
        this.setupEventListeners();
        this.updateStats();
        this.startNewGame();
      }
      
      setupEventListeners() {
        // Ch·ªçn c·∫•p ƒë·ªô
        document.querySelectorAll('.mode-btn').forEach(btn => {
          btn.addEventListener('click', (e) => this.changeMode(e.currentTarget));
        });
        
        // Form ƒëo√°n s·ªë
        document.getElementById('guessForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.handleGuess();
        });
        
        // N√∫t b·∫•m
        document.getElementById('hintBtn').addEventListener('click', () => this.giveHint());
        document.getElementById('restartBtn').addEventListener('click', () => this.startNewGame());
        document.getElementById('playAgainBtn').addEventListener('click', () => this.startNewGame());
        
        // Auto-focus khi nh·∫≠p
        document.addEventListener('input', (e) => {
          if (e.target.classList.contains('number-input')) {
            this.handleInputNavigation(e.target);
          }
        });
      }
      
      changeMode(modeButton) {
        // C·∫≠p nh·∫≠t n√∫t active
        document.querySelectorAll('.mode-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        modeButton.classList.add('active');
        
        // C·∫≠p nh·∫≠t c·∫•p ƒë·ªô
        this.currentMode = modeButton.dataset.mode;
        
        // Hi·ªÉn th·ªã c·∫•p ƒë·ªô
        const levelText = this.currentMode === 'easy' ? 'D·ªÖ' : 
                         this.currentMode === 'normal' ? 'Trung b√¨nh' : 'Kh√≥';
        document.getElementById('level').textContent = levelText;
        
        // B·∫Øt ƒë·∫ßu game m·ªõi
        this.startNewGame();
      }
      
      startNewGame() {
        this.gameActive = true;
        this.attempts = 0;
        this.history = [];
        this.hintsLeft = 3;
        this.secretNumber = this.generateSecretNumber();
        
        // X√≥a giao di·ªán c≈©
        document.getElementById('history').innerHTML = '';
        document.getElementById('endMessage').innerHTML = '';
        document.getElementById('endMessage').style.display = 'none';
        document.getElementById('playAgain').style.display = 'none';
        document.getElementById('error').textContent = '';
        document.getElementById('guessForm').style.display = 'block';
        
        // C·∫≠p nh·∫≠t giao di·ªán
        this.updateInputs();
        this.updateAttemptInfo();
        this.updateHintButton();
        this.updateStats();
        
        // B·∫Øt ƒë·∫ßu ƒë·∫øm th·ªùi gian
        this.startTimer();
        
        // Focus v√†o √¥ ƒë·∫ßu ti√™n
        setTimeout(() => {
          const firstInput = document.querySelector('.number-input');
          if (firstInput) firstInput.focus();
        }, 100);
      }
      
      generateSecretNumber() {
        const length = this.config[this.currentMode].length;
        let digits = [1, 2, 3, 4, 5, 6, 7, 8, 9];
        
        // Ch·ªØ s·ªë ƒë·∫ßu kh√¥ng ƒë∆∞·ª£c l√† 0
        const first = digits[Math.floor(Math.random() * digits.length)];
        const secret = [first];
        
        // C√°c ch·ªØ s·ªë c√≤n l·∫°i c√≥ th·ªÉ c√≥ 0
        digits = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9].filter(d => d !== first);
        
        while (secret.length < length) {
          const idx = Math.floor(Math.random() * digits.length);
          const digit = digits.splice(idx, 1)[0];
          secret.push(digit);
        }
        
        return secret;
      }
      
      updateInputs() {
        const length = this.config[this.currentMode].length;
        const inputsContainer = document.getElementById('inputs');
        
        let html = '';
        for (let i = 0; i < length; i++) {
          html += `
            <input type="number" 
                   min="0" 
                   max="9" 
                   maxlength="1" 
                   class="number-input" 
                   required
                   data-index="${i}"
                   autocomplete="off">
          `;
        }
        
        inputsContainer.innerHTML = html;
        document.getElementById('currentLength').textContent = length;
      }
      
      handleInputNavigation(input) {
        const index = parseInt(input.dataset.index);
        const inputs = Array.from(document.querySelectorAll('.number-input'));
        
        if (input.value.length === 1 && index < inputs.length - 1) {
          inputs[index + 1].focus();
        }
        
        // X√≥a √¥ ti·∫øp theo n·∫øu x√≥a √¥ hi·ªán t·∫°i
        if (input.value === '' && index > 0) {
          inputs[index - 1].focus();
        }
      }
      
      updateAttemptInfo() {
        const maxAttempts = this.config[this.currentMode].maxAttempts;
        document.getElementById('attemptInfo').textContent = 
          `${this.attempts}/${maxAttempts}`;
      }
      
      updateHintButton() {
        const hintCount = document.getElementById('hintCount');
        hintCount.textContent = `(${this.hintsLeft})`;
        document.getElementById('hintBtn').disabled = this.hintsLeft === 0;
      }
      
      updateStats() {
        document.getElementById('score').textContent = this.score;
        document.getElementById('highScore').textContent = this.highScore;
        document.getElementById('currentScore').textContent = this.calculateCurrentGameScore();
      }
      
      startTimer() {
        this.stopTimer();
        this.startTime = Date.now();
        
        this.timerInterval = setInterval(() => {
          const elapsed = Date.now() - this.startTime;
          const minutes = Math.floor(elapsed / 60000);
          const seconds = Math.floor((elapsed % 60000) / 1000);
          document.getElementById('timer').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
      }
      
      stopTimer() {
        if (this.timerInterval) {
          clearInterval(this.timerInterval);
          this.timerInterval = null;
        }
      }
      
      handleGuess() {
        if (!this.gameActive) return;
        
        const inputs = Array.from(document.querySelectorAll('.number-input'));
        const guess = inputs.map(inp => Number(inp.value));
        
        // Ki·ªÉm tra h·ª£p l·ªá
        const validation = this.validateGuess(guess);
        if (!validation.valid) {
          document.getElementById('error').textContent = validation.message;
          return;
        }
        
        // X√≥a th√¥ng b√°o l·ªói
        document.getElementById('error').textContent = '';
        
        // Ki·ªÉm tra ƒëo√°n
        const result = this.checkGuess(guess);
        this.attempts++;
        this.history.push({ guess: [...guess], result: [...result] });
        
        // C·∫≠p nh·∫≠t giao di·ªán
        this.displayHistory();
        this.updateAttemptInfo();
        this.updateStats();
        
        // Ki·ªÉm tra k·∫øt th√∫c game
        if (this.isCorrect(result)) {
          this.endGame(true);
        } else if (this.attempts >= this.config[this.currentMode].maxAttempts) {
          this.endGame(false);
        } else {
          // X√≥a input cho l∆∞·ª£t ti·∫øp theo
          inputs.forEach(inp => inp.value = '');
          inputs[0].focus();
        }
      }
      
      validateGuess(guess) {
        const length = this.config[this.currentMode].length;
        
        // Ki·ªÉm tra ƒë·ªß s·ªë
        if (guess.length !== length || guess.some(isNaN)) {
          return { valid: false, message: `Vui l√≤ng nh·∫≠p ƒë·ªß ${length} ch·ªØ s·ªë!` };
        }
        
        // Ch·ªØ s·ªë ƒë·∫ßu kh√¥ng ƒë∆∞·ª£c l√† 0
        if (guess[0] === 0) {
          return { valid: false, message: 'Ch·ªØ s·ªë ƒë·∫ßu ti√™n ph·∫£i kh√°c 0!' };
        }
        
        // Ki·ªÉm tra tr√πng s·ªë
        const set = new Set(guess);
        if (set.size !== length) {
          return { valid: false, message: 'C√°c ch·ªØ s·ªë kh√¥ng ƒë∆∞·ª£c tr√πng nhau!' };
        }
        
        // Ki·ªÉm tra ph·∫°m vi
        if (guess.some(d => d < 0 || d > 9)) {
          return { valid: false, message: 'Ch·ªâ ƒë∆∞·ª£c nh·∫≠p s·ªë t·ª´ 0 ƒë·∫øn 9!' };
        }
        
        return { valid: true, message: '' };
      }
      
      checkGuess(guess) {
        const result = Array(this.config[this.currentMode].length).fill(0);
        
        for (let i = 0; i < guess.length; i++) {
          if (guess[i] === this.secretNumber[i]) {
            result[i] = 2; // ƒê√∫ng s·ªë v√† v·ªã tr√≠
          } else if (this.secretNumber.includes(guess[i])) {
            result[i] = 1; // ƒê√∫ng s·ªë, sai v·ªã tr√≠
          }
        }
        
        return result;
      }
      
      isCorrect(result) {
        return result.every(r => r === 2);
      }
      
      displayHistory() {
        const historyContainer = document.getElementById('history');
        
        this.history.forEach((entry, index) => {
          const historyItem = document.createElement('div');
          historyItem.className = 'history-item';
          historyItem.innerHTML = `
            <div class="guess-numbers">
              ${entry.guess.map(d => `<span>${d}</span>`).join('')}
            </div>
            <div class="guess-feedback">
              ${entry.result.map(res => {
                let iconClass = '';
                let icon = '';
                
                if (res === 2) {
                  iconClass = 'correct';
                  icon = '<i class="fas fa-check"></i>';
                } else if (res === 1) {
                  iconClass = 'partial';
                  icon = '<i class="fas fa-exchange-alt"></i>';
                } else {
                  iconClass = 'wrong';
                  icon = '<i class="fas fa-times"></i>';
                }
                
                return `<span class="feedback-icon ${iconClass}">${icon}</span>`;
              }).join('')}
            </div>
          `;
          
          historyContainer.prepend(historyItem);
        });
      }
      
      giveHint() {
        if (this.hintsLeft === 0 || !this.gameActive) return;
        
        this.hintsLeft--;
        this.updateHintButton();
        
        // T√¨m v·ªã tr√≠ ch∆∞a ti·∫øt l·ªô
        const unrevealedPositions = [];
        for (let i = 0; i < this.secretNumber.length; i++) {
          if (!this.history.some(entry => entry.result[i] === 2)) {
            unrevealedPositions.push(i);
          }
        }
        
        if (unrevealedPositions.length === 0) return;
        
        // Ti·∫øt l·ªô m·ªôt ch·ªØ s·ªë ng·∫´u nhi√™n
        const randomPos = unrevealedPositions[Math.floor(Math.random() * unrevealedPositions.length)];
        const digit = this.secretNumber[randomPos];
        
        // Hi·ªÉn th·ªã g·ª£i √Ω
        const hintMessage = `üí° G·ª£i √Ω: S·ªë ·ªü v·ªã tr√≠ ${randomPos + 1} l√† ${digit}`;
        document.getElementById('error').textContent = hintMessage;
        document.getElementById('error').style.color = '#ffb142';
        
        // T·ª± ƒë·ªông x√≥a g·ª£i √Ω sau 3 gi√¢y
        setTimeout(() => {
          if (document.getElementById('error').textContent === hintMessage) {
            document.getElementById('error').textContent = '';
          }
        }, 3000);
      }
      
      calculateCurrentGameScore() {
        if (this.history.length === 0) return 0;
        
        const baseScore = 1000;
        const timeBonus = Math.max(0, 300 - Math.floor((Date.now() - this.startTime) / 1000));
        const attemptsBonus = (this.config[this.currentMode].maxAttempts - this.attempts) * 50;
        const multiplier = this.config[this.currentMode].multiplier;
        const hintPenalty = (3 - this.hintsLeft) * 100;
        
        return Math.max(0, (baseScore + timeBonus + attemptsBonus - hintPenalty) * multiplier);
      }
      
      endGame(win) {
        this.gameActive = false;
        this.stopTimer();
        
        const endMessage = document.getElementById('endMessage');
        const playAgainContainer = document.getElementById('playAgain');
        
        if (win) {
          const gameScore = this.calculateCurrentGameScore();
          this.score += gameScore;
          
          if (this.score > this.highScore) {
            this.highScore = this.score;
            this.saveHighScore();
          }
          
          endMessage.innerHTML = `
            <i class="fas fa-trophy"></i>
            <h3>üéâ CH√öC M·ª™NG!</h3>
            <p>B·∫°n ƒë√£ ƒëo√°n ƒë√∫ng s·ªë sau ${this.attempts} l·∫ßn th·ª≠!</p>
            <p>ƒêi·ªÉm: <strong>${gameScore}</strong></p>
            <p>T·ªïng ƒëi·ªÉm: <strong>${this.score}</strong></p>
          `;
          endMessage.className = 'game-result win';
          endMessage.style.display = 'block';
        } else {
          endMessage.innerHTML = `
            <i class="fas fa-skull-crossbones"></i>
            <h3>üíÄ GAME OVER!</h3>
            <p>B·∫°n ƒë√£ h·∫øt l∆∞·ª£t ƒëo√°n.</p>
            <p>S·ªë b√≠ m·∫≠t l√†: <strong>${this.secretNumber.join(' ')}</strong></p>
            <p>Ch√∫c may m·∫Øn l·∫ßn sau!</p>
          `;
          endMessage.className = 'game-result lose';
          endMessage.style.display = 'block';
        }
        
        playAgainContainer.style.display = 'flex';
        document.getElementById('guessForm').style.display = 'none';
        this.updateStats();
      }
      
      loadHighScore() {
        try {
          const score = localStorage.getItem('gameDoanSoHighScore');
          return score ? parseInt(score) : 0;
        } catch {
          return 0;
        }
      }
      
      saveHighScore() {
        localStorage.setItem('gameDoanSoHighScore', this.highScore.toString());
      }
    }
    
    // Kh·ªüi t·∫°o game khi trang load
    document.addEventListener('DOMContentLoaded', () => {
      window.game = new GameDoanSo();
    });
  </script>
</body>
</html>
